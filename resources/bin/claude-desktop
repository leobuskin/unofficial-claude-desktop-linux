#!/bin/bash
APP_DIR="$(dirname "$(dirname "$(readlink -f "$0")")")"

# Build proxy arguments for Electron/Chromium
PROXY_ARGS=""

# Check for proxy environment variables (prefer lowercase, fallback to uppercase)
PROXY_URL="${https_proxy:-${HTTPS_PROXY:-${http_proxy:-${HTTP_PROXY:-}}}}"
NO_PROXY_LIST="${no_proxy:-${NO_PROXY:-}}"

if [ -n "$PROXY_URL" ]; then
    PROXY_ARGS="--proxy-server=$PROXY_URL"

    if [ -n "$NO_PROXY_LIST" ]; then
        PROXY_ARGS="$PROXY_ARGS --proxy-bypass-list=$NO_PROXY_LIST"
    fi
fi

# Launch with Wayland support if available
exec "$APP_DIR/lib/claude-desktop/node_modules/electron/dist/electron" \
    "$APP_DIR/lib/claude-desktop/app.asar" \
    ${WAYLAND_DISPLAY:+--ozone-platform-hint=auto --enable-features=WaylandWindowDecorations} \
    $PROXY_ARGS "$@"
